// Module included in the following assemblies:
//
//* distr_tracing_tempo/distr-tracing-tempo-installing.adoc

:_content-type: PROCEDURE
[id="distr-tracing-tempo-install-cli_{context}"]
= Installing {TempoName} by using the CLI

Installing {TempoName} by using the CLI involves installing the Tempo Operator, creating a Secret and namespace, and using the Operator to deploy a TempoStack instance in the namespace for use with the Secret.
//|Tempo Operator| might need changing to {TempoShortName}.

.Prerequisites

* An active OpenShift CLI (`oc`) session by a xref:https://docs.openshift.com/container-platform/latest/admin_solutions/user_role_mgmt.html#creating-a-cluster-administrator[cluster administrator with the `cluster-admin` role]. See link:https://docs.openshift.com/container-platform/{ocp4-ver}/cli_reference/openshift_cli/getting-started-cli.html[Getting started with the OpenShift CLI].
+
TIP: Ensure that your OpenShift CLI (`oc`) version is up to date and matches your {product-title} version.

* You are using a supported provider of object storage: link:https://www.redhat.com/en/technologies/cloud-computing/openshift-data-foundation[Red Hat OpenShift Data Foundation], link:https://min.io/[MinIO], link:https://aws.amazon.com/s3/[Amazon S3], link:https://azure.microsoft.com/en-us/products/storage/blobs/[Azure Blob Storage], link:https://cloud.google.com/storage/[Google Cloud Storage].

. Install the Tempo Operator:

.. Create a subscription.
+
[source,yaml]
----
$ oc apply -f - << EOF
apiVersion: operators.coreos.com/v1alpha1
kind: Subscription
metadata:
  name: tempo-product
  namespace: openshift-operators
spec:
  channel: stable
  installPlanApproval: Automatic
  name: tempo-product
  source: redhat-operators
  sourceNamespace: openshift-marketplace
EOF
----

.. Check the Operator status.
+
[source,terminal]
----
$ oc get csv -n openshift-operators
----

. Run `oc apply -f` to create a Secret for your object storage bucket.
+
[TIP]
====
[source,terminal]
----
$ oc apply -f <secret_file>.yaml
----

[source,terminal]
----
$ oc apply -f - << EOF
<object_storage_secret>
EOF
----
====

include::snippets/distr-tracing-tempo-required-secret-parameters-and-secret-example.adoc[]

. Use `oc create namespace` or `oc apply` to create a namespace for the *TempoStack* instance that you will create in the next step.
+
[TIP]
====
[source,terminal]
----
$ oc create namespace <namespace_value_of_your_choice>
----

[source,terminal]
----
$ oc apply -f - << EOF
apiVersion: project.openshift.io/v1
kind: Project
metadata:
  labels:
    kubernetes.io/metadata.name: <namespace_value_of_your_choice>
    openshift.io/cluster-monitoring: "true"
  name: <namespace_value_of_your_choice>
EOF
----
====

. Create a *TempoStack* instance in the namespace that you created for the *TempoStack* instance in the previous step.
+
NOTE: You can create multiple *TempoStack* instances in separate namespaces on the same cluster.
+
.. Customize the `TempoStack` custom resource (CR):
+
[source,yaml]
----
apiVersion: tempo.grafana.com/v1alpha1
kind: TempoStack
metadata:
  name: sample
  namespace: <namespace_from_previous_step>
spec:
  storageSize: 1Gi
  storage:
      secret:
          name: <secret-name> <1>
          type: <secret-provider> <2>
  template:
    queryFrontend:
      jaegerQuery:
        enabled: true
        ingress:
          route:
            termination: edge
          type: route
----
<1> The value of `name` in the `metadata` of the Secret.
<2> The accepted values are `azure` for Azure Blob Storage, `gcs` for Google Cloud Storage, and `s3` for Amazon S3 or MinIO or Red Hat OpenShift Data Foundation.
+
.TempoStack CR for AWS S3 and MinIO storage
====
[source,yaml]
----
apiVersion: tempo.grafana.com/v1alpha1
kind: TempoStack
metadata:
  name: simplest
  namespace: tempostacknamespace
spec:
  storageSize: 1Gi
  storage:
    secret:
      name: minio-test
      type: s3
  resources:
    total:
      limits:
        memory: 2Gi
        cpu: 2000m
  template:
    queryFrontend:
      jaegerQuery:
        enabled: true
        ingress:
          route:
            termination: edge
          type: route
----
The stack deployed in this example is configured to receive Jaeger Thrift over HTTP and OpenTelemetry Protocol (OTLP), which permits visualizing the data with the Jaeger UI.
====

.. Apply the customized CR.
+
[source,terminal]
----
$ oc apply -f - << EOF
<TempoStack_custom_resource>
EOF
----

.WIP:

. command(s) to confirm successful deployment of a TempoStack instance
+
For example:
.. A command that prints output to verify that pods are created on the namespace.
.. A command that enables the CLI user to watch for the stack to stabilize.

. if applicable, a command to open any UI console
. any other commands?
