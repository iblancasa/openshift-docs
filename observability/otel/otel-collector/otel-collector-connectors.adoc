:_mod-docs-content-type: ASSEMBLY
[id="otel-collector-connectors"]
= Connectors
include::_attributes/common-attributes.adoc[]
:context: otel-collector-connectors

toc::[]

A connector connects two pipelines. It consumes data as an exporter at the end of one pipeline and emits data as a receiver at the start of another pipeline. It can consume and emit data of the same or different data type. It can generate and emit data to summarize the consumed data, or it can merely replicate or route data.

[id="count-connector_{context}"]
== Count Connector

The `count` connector is used to count spans, span events, metrics, data points, and log records.

:FeatureName: The Count Connector
include::snippets/technology-preview.adoc[]

.OpenTelemetry Collector custom resource with an enabled Count Connector
[source,yaml]
----
  config: |
    receivers:
      otlp:
        protocols:
          grpc: # <1>
            endpoint: 0.0.0.0:4317
    exporters:
      prometheus: # <2>
        endpoint: 0.0.0.0:8889
    connectors:
      count:

    service:
      pipelines:
        traces/in:
          receivers: [otlp]
          exporters: [count] # <3>
        metrics/out:
          receivers: [count] # <4>
          exporters: [prometheus]
----
<1> Example configuration for OTLP receiver.
<2> Example configuration for Prometheus metrics exporter.
<3> The Count Connector is used here as an exporter to receive all the spans.
<4> The Count Connector is used here as a receiver to emit the generated metrics.

.Count Connector default behavior
[options="header"]
[cols="a,a,a"]
|===
| Exporter Pipeline Type | Description | Default Metric Names

| traces
| Counts all spans and span events.
| `trace.span.count`, `trace.span.event.count`

| metrics
| Counts all metrics and data points.
| `metric.count`, `metric.datapoint.count`

| logs
| Counts all log records.
| `log.record.count`
|===

=== Custom counts

You can define custom counts for the `spans`, `spanevents`, `metrics`, `datapoints`, and `logs` telemetry types.

For instante, the Count Connector allows the creation of metrics based on conditions:
.OpenTelemetry Collector custom resource with an enabled Count Connector using conditions
[source,yaml]
----
  config: |
    connectors:
      count:
        spans:
          cluster.prod.event.count:
            description: Number of spans from the dev environment
            conditions:
              - 'attributes["env"] == "dev"'
              - 'name == "devevent"'
----

You can count `spans`, `spanevents`, `datapoints`, and `logs` according to attributes:
.OpenTelemetry Collector custom resource with an enabled Count Connector counting according to attributes
[source,yaml]
----
  config: |
    connectors:
      count:
        logs:
          my.log.count:
            description: The number of logs from each environment.
            attributes:
              - key: env
                default_value: unknown # <1>
----
<1> `default_value` defines a default value when the attribute is not set.

=== Troubleshooting

==== Count metrics not being generated as expected

If the Count Connector is not generating the expected metrics, consider the following:

.Procedure

- Verify the pipeline configuration: ensure the Count Connector is correctly configured as an exporter or receiver in the pipeline. Check that telemetry data flows through the connector as expected.
+
- Check conditions: if using conditions for counting specific spans, metrics, or logs, verify that the conditions are correctly specified in the configuration.
+
- Confirm attribute configuration: if counting by attributes, ensure that the attribute keys are present in the telemetry data and that the `default_value` is correctly defined for missing attributes.
+
- Check telemetry input: verify that the OpenTelemetry Collector is receiving the expected spans, metrics, and logs. Use the `Debug Exporter` to inspect the incoming telemetry data.
+
- Validate metric names: ensure that custom metric names are correctly specified in the configuration and match the data you want to count.
+
- Ensure proper exporter configuration: confirm that the Count Connector is exporting the generated metrics to the correct exporter (e.g., Prometheus).
+
- Verify condition syntax: check that the conditions are correctly written and follow the required syntax for attribute matching or telemetry field conditions.


[id="routing-connector_{context}"]
== Routing Connector

The Routing Connector routes logs, metrics, and traces to specified pipelines according to resource attributes and their routing conditions, which are written as OpenTelemetry Transformation Language (OTTL) statements.

:FeatureName: The Routing Connector
include::snippets/technology-preview.adoc[]

.OpenTelemetry Collector custom resource with an enabled Routing Connector
[source,yaml]
----
  config: |
    connectors:
      routing:
        table: # <1>
          - statement: route() where attributes["X-Tenant"] == "dev" # <2>
            pipelines: [traces/dev] # <3>
          - statement: route() where attributes["X-Tenant"] == "prod"
            pipelines: [traces/prod]
        default_pipelines: [traces/dev] # <4>
        error_mode: ignore # <5>
        match_once: false # <6>
    service:
      pipelines:
        traces/in:
          receivers: [otlp]
          exporters: [routing]
        traces/dev:
          receivers: [routing]
          exporters: [otlp/dev]
        traces/prod:
          receivers: [routing]
          exporters: [otlp/prod]
----
<1> Connector routing table.
<2> Routing conditions written as OTTL statements.
<3> Destination pipelines for routing the matching telemetry data.
<4> Destination pipelines for routing the telemetry data for which no routing condition is satisfied.
<5> Error-handling mode: The `propagate` value is for logging an error and dropping the payload. The `ignore` value is for ignoring the condition and attempting to match with the next one. The `silent` value is the same as `ignore` but without logging the error. The default is `propagate`.
<6>  When set to `true`, the payload is routed only to the first pipeline whose routing condition is met. The default is `false`.

[id="forward-connector_{context}"]
== Forward Connector

The Forward Connector merges two pipelines of the same type.

:FeatureName: The Forward Connector
include::snippets/technology-preview.adoc[]

.OpenTelemetry Collector custom resource with an enabled Forward Connector
[source,yaml]
----
# ...
receivers:
  otlp:
    protocols:
      grpc:
  jaeger:
    protocols:
      grpc:
processors:
  batch:
exporters:
  otlp:
    endpoint: tempo-simplest-distributor:4317
    tls:
      insecure: true
connectors:
  forward:
service:
  pipelines:
    traces/regiona:
      receivers: [otlp]
      processors: []
      exporters: [forward]
    traces/regionb:
      receivers: [jaeger]
      processors: []
      exporters: [forward]
    traces:
      receivers: [forward]
      processors: [batch]
      exporters: [otlp]
# ...
----

[id="spanmetrics-connector_{context}"]
== Spanmetrics Connector

The Spanmetrics Connector aggregates Request, Error, and Duration (R.E.D) OpenTelemetry metrics from span data.

:FeatureName: The Spanmetrics Connector
include::snippets/technology-preview.adoc[]

.OpenTelemetry Collector custom resource with an enabled Spanmetrics Connector
[source,yaml]
----
# ...
  config: |
    connectors:
      spanmetrics:
        metrics_flush_interval: 15s # <1>
    service:
      pipelines:
        traces:
          exporters: [spanmetrics]
        metrics:
          receivers: [spanmetrics]
# ...
----
<1> Defines the flush interval of the generated metrics. Defaults to `15s`.

[role="_additional-resources"]
[id="additional-resources_otel-collector-connectors_{context}"]
== Additional resources
* link:https://opentelemetry.io/docs/specs/otlp/[OpenTelemetry Protocol (OTLP) documentation]
